
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Backend Data ETL Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../SECURITY.html" />
    
    
    <link rel="prev" href="frontend-architecture.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../INTRO.html">
            
                <a href="../INTRO.html">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../welcome/application-screenshots.html">
            
                <a href="../welcome/application-screenshots.html">
            
                    
                    Application Screenshots
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../COST.html">
            
                <a href="../COST.html">
            
                    
                    Cost
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../ARCHITECTURE.html">
            
                <a href="../ARCHITECTURE.html">
            
                    
                    Solution Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    Solution Components
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="frontend-architecture.html">
            
                <a href="frontend-architecture.html">
            
                    
                    Frontend Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.2" data-path="backend-data-etl.html">
            
                <a href="backend-data-etl.html">
            
                    
                    Backend Data ETL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../SECURITY.html">
            
                <a href="../SECURITY.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../DESIGN.html">
            
                <a href="../DESIGN.html">
            
                    
                    Design Considerations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../CLOUDFORMATION.html">
            
                <a href="../CLOUDFORMATION.html">
            
                    
                    AWS CloudFormation Templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../deployment/">
            
                <a href="../deployment/">
            
                    
                    Deployment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../deployment/frontend-deployment.html">
            
                <a href="../deployment/frontend-deployment.html">
            
                    
                    Frontend Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../deployment/backend-deployment.html">
            
                <a href="../deployment/backend-deployment.html">
            
                    
                    Backend Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../USAGE.html">
            
                <a href="../USAGE.html">
            
                    
                    Using the Solution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../ADDITIONAL_RESOURCES.html">
            
                <a href="../ADDITIONAL_RESOURCES.html">
            
                    
                    Additional Resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../REVISIONS.html">
            
                <a href="../REVISIONS.html">
            
                    
                    Revisions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../CONTRIBUTORS.html">
            
                <a href="../CONTRIBUTORS.html">
            
                    
                    Contributors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../NOTICES.html">
            
                <a href="../NOTICES.html">
            
                    
                    Notices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../GLOSSARY.html">
            
                <a href="../GLOSSARY.html">
            
                    
                    AWS Glossary
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Backend Data ETL</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="backend-data-etl">Backend Data ETL</h1>
<p>All data was initially processed using a AWS Step Function running a sequence of AWS Lambdas.</p>
<h3 id="step-function-diagram">Step Function Diagram</h3>
<p><img src="../assets/stepfunction.png" alt="Step Function State Machine Diagram"></p>
<h3 id="step-function-descriptions">Step Function Descriptions</h3>
<ul>
<li>The get_data function in AWS Lambda fetches the 2016 Census data from the Statistics Canada website and stores it in an Amazon S3 bucket.</li>
<li>The clean_and_combine_T1 function in AWS Lambda takes the two provided T1 datasets (Donations by Family Type and Donations by Income Group) and combines them into one. Then, the combined dataset is filtered for 2016 data only, as the original datasets contained data from 2006 to 2018. This function also cleans the numerical columns, renames some columns for clarity, and drops unnecessary columns (for example, year after the data has been filtered for 2016, and place names).</li>
<li>The add_province_T1 function in AWS Lambda adds a province column to the T1 dataset produced by clean_and_combine_T1. The province is determined based on the FSA. The dataset produced from this step is the fully processed T1 data, and is stored in JSON format in the Amazon S3 bucket.</li>
<li>The T1_to_DB function in AWS Lambda takes the T1 dataset produced by add_province_T1 and puts it in Amazon DynamoDB, using the schema provided in Appendix A (Data Schema).</li>
<li>The clean_census function in AWS Lambda takes the 2016 Census data fetched in get_data and performs various data cleaning functions. This includes renaming and removing various columns (such as year, repeated FSA columns, and footnote references), as well as removing some invalid values from numerical columns.</li>
<li>The map_headers_and_populations function in AWS Lambda creates a file that maps the Census data categories to a broader collection designation (this is referred to as a header in the data). In addition, this file marks whether or not we want to keep specific categories in the data. It also creates a file that maps a category and an FSA to a total population of which the category value is a fraction of.</li>
<li>The add_province_census function in AWS Lambda adds a province column to the Census dataset produced from clean_census. The province is determined based on the FSA.</li>
<li>The join_populations_and_census function in AWS Lambda joins the Census dataset produced by add_province_census with the populations dataset produced by map_headers_and_populations, in preparation for the next step. It also combines the headers dataset created by map_headers_and_populations with the Census data. When we join with the headers dataset, undesired categories are filtered out of the census data.</li>
<li>The calculate_percent function in AWS Lambda takes each row in the Census dataset produced by join_populations_and_census and calculates the category value as a percentage of the total population it is a fraction of. The dataset produced from this step is the fully processed Census data, and is stored in JSON format in the Amazon S3 bucket.</li>
<li>The census_to_DB function in AWS Lambda takes the Census dataset produced by calculate_percent and puts it in Amazon DynamoDB, using the schema provided in Appendix A (Data Schema).</li>
<li>The CleanUpS3 function in AWS Lambda removes all of the temporary datasets created by the previous steps from the Amazon S3 bucket. It does not delete the original datasets, nor the fully processed datasets produced from add_province_T1 and calculate_percent.</li>
</ul>
<h3 id="datasets">Datasets</h3>
<ul>
<li><strong>Census Data</strong>: The 2016 Census data contains various statistics from the Canadian Census, such as Age, Sex, Type of Dwelling, Families, Households, Marital Status, Language, Income, Immigration and Ethnocultural Diversity, Housing, Aboriginal Peoples, Education, Labour, Journey to Work, Mobility and Migration, and Language of Work for Canada and Forward Sortation Areas. Each statistic is aggregated by Forward Sortation Area (FSA). This data was obtained from the <a href="https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/prof/details/download-telecharger/comp/page_dl-tc.cfm?Lang=E" target="_blank">Statistics Canada website</a>.</li>
<li><strong>T1 Donation Data by Family Type</strong>: The T1 Donation Data by Family Type contains data about the charitable donations made by different family types. This includes total amount donated, median donation amount, number of donations made, and donation rate. Each statistic is aggregated by Forward Sortation Area (FSA).</li>
<li><strong>T1 Donation Data by Income Group</strong>: The T1 Donation Data by Income Group contains data about the charitable donations made by different income groups. This includes total amount donated, median donation amount, number of donations made, and donation rate. Each statistic is aggregated by Forward Sortation Area (FSA).</li>
</ul>
<h3 id="manual-data-processing">Manual Data Processing</h3>
<p>The file headers.csv in the data folder was created by copying the table from <a href="https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/prof/details/page.cfm?Lang=E&amp;Geo1=PR&amp;Code1=01&amp;Geo2=&amp;Code2=&amp;SearchText=Canada&amp;SearchType=Begins&amp;SearchPR=01&amp;B1=All&amp;TABID=1&amp;type=0" target="_blank">Statistics Canada</a> into a spreadsheet in order to find the category groupings that were not otherwise represented in the Census data. After copying the table, the actual statistics were removed, and each category was marked with whether or not it would be kept for the app. Each category was numbered from 1 to 2247, corresponding to the ID given in the Census data (an ID was necessary as the categories do not have unique names). The file was then saved as a csv and used for further processing within the data preparation step function.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="frontend-architecture.html" class="navigation navigation-prev " aria-label="Previous page: Frontend Architecture">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../SECURITY.html" class="navigation navigation-next " aria-label="Next page: Security">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Backend Data ETL","level":"1.5.2","depth":2,"next":{"title":"Security","level":"1.6","depth":1,"path":"SECURITY.md","ref":"SECURITY.md","articles":[]},"previous":{"title":"Frontend Architecture","level":"1.5.1","depth":2,"path":"components/frontend-architecture.md","ref":"components/frontend-architecture.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"components/backend-data-etl.md","mtime":"2022-03-07T05:32:15.774Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-03-22T20:07:56.456Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

